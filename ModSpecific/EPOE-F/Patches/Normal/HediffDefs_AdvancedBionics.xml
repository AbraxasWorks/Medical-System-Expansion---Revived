<?xml version="1.0" encoding="utf-8" ?>
<Patch>

	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Expanded Prosthetics and Organ Engineering - Forked</li>
			<li>Expanded Prosthetics, Implants and Augmentations</li>
		</mods>
		<match Class="PatchOperationSequence">
			<operations>

				<!-- adv bionic arm -->

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/ThingDef[@ParentName="EPIA_UpgradeBodyPartAdvancedBionicBase"][defName="AdvancedBionicArm"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.CompProperties_IncludedChildParts">
								<standardChildren>
									<li>AdvancedBionicForearm</li>
									<li>AdvancedBionicInternalSupport</li>
								</standardChildren>
							</li>
						</comps>
					</value>
				</li>

				<!-- adv bionic leg -->

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/HediffDef[@ParentName="addedPartAdvanced"][defName="AdvancedBionicLeg"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.HediffCompProperties_ModuleHolder">
								<maxModules>1</maxModules>
							</li>
						</comps>
					</value>
				</li>

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/ThingDef[@ParentName="EPIA_UpgradeBodyPartAdvancedBionicBase"][defName="AdvancedBionicLeg"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.CompProperties_IncludedChildParts">
								<standardChildren>
									<li>AdvancedBionicFoot</li>
									<li>AdvancedBionicInternalSupport</li>
								</standardChildren>
							</li>
						</comps>
					</value>
				</li>

				<!-- adv bionic hand -->

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/HediffDef[@ParentName="addedPartAdvanced"][defName="AdvancedBionicHand"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.HediffCompProperties_ModuleHolder">
								<maxModules>1</maxModules>
							</li>
						</comps>
					</value>
				</li>

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/ThingDef[@ParentName="EPIA_UpgradeBodyPartAdvancedBionicBase"][defName="AdvancedBionicHand"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.CompProperties_IncludedChildParts">
								<standardChildren>
									<li>AdvancedBionicFinger</li>
								</standardChildren>
							</li>
						</comps>
					</value>
				</li>

				<!-- adv bionic foot -->

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/ThingDef[@ParentName="EPIA_UpgradeBodyPartAdvancedBionicBase"][defName="AdvancedBionicFoot"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.CompProperties_IncludedChildParts">
								<standardChildren>
									<li>AdvancedBionicToe</li>
								</standardChildren>
							</li>
						</comps>
					</value>
				</li>

				<!-- adv power arm -->

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/ThingDef[@ParentName="EPIA_UpgradeBodyPartAdvancedBionicBase"][defName="AdvancedPowerArm"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.CompProperties_IncludedChildParts">
								<standardChildren>
									<li>AdvancedPowerForearm</li>
									<li>AdvancedBionicInternalSupport</li>
								</standardChildren>
							</li>
						</comps>
					</value>
				</li>

				<li Class="PatchOperationAddOrMerge">
					<xpath>/Defs/HediffDef[@ParentName="addedPartAdvanced"][defName="AdvancedPowerArm"]</xpath>
					<value>
						<comps>
							<li Class="MSE2.HediffCompProperties_ModuleHolder">
								<maxModules>2</maxModules>
							</li>
						</comps>
					</value>
				</li>


				<!-- remove verbs -->
				<li Class="PatchOperationRemove">
					<xpath>/Defs/HediffDef[@ParentName="addedPartAdvanced"][defName="AdvancedBionicArm" or defName="AdvancedPowerArm"]/comps/li[@Class="HediffCompProperties_VerbGiver"]</xpath>
				</li>

				<!-- melee verbs on power hand -->

				<li Class="PatchOperationFindMod">
					<mods>
						<li>Combat Extended</li>
					</mods>
					<match Class="PatchOperationAddOrMerge">
						<xpath>/Defs/HediffDef[@ParentName="addedPartAdvanced"][defName="AdvancedPowerHand"]</xpath>
						<value>
							<comps>
								<li Class="HediffCompProperties_VerbGiver">
									<tools>
										<li Class="CombatExtended.ToolCE">
											<label>bionic fist</label>
											<capacities>
												<li>Blunt</li>
											</capacities>
											<power>9</power>
											<armorPenetrationBlunt>3</armorPenetrationBlunt>
											<cooldownTime>0.83</cooldownTime>
										</li>
									</tools>
								</li>
							</comps>
						</value>
					</match>
					<nomatch Class="PatchOperationAddOrMerge">
						<xpath>/Defs/HediffDef[@ParentName="addedPartAdvanced"][defName="AdvancedPowerHand"]</xpath>
						<value>
							<comps>
								<li Class="HediffCompProperties_VerbGiver">
									<tools>
										<li>
											<label>bionic fist</label>
											<capacities>
												<li>Blunt</li>
											</capacities>
											<power>16</power>
											<cooldownTime>1.65</cooldownTime>
										</li>
									</tools>
								</li>
							</comps>
						</value>
					</nomatch>
				</li>

			</operations>
		</match>
	</Operation>
</Patch>