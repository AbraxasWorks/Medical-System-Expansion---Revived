<?xml version="1.0" encoding="utf-8" ?>
<Patch>

  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Prosthetics and Organ Engineering</li>
    </mods>
    <match Class="PatchOperationSequence">
      <operations>

        <!-- remove verbs -->
        <li Class="PatchOperationRemove">
          <xpath>/Defs/HediffDef[@ParentName="addedPartBionics"][defName="PowerArm"]/comps/li[@Class="HediffCompProperties_VerbGiver"]</xpath>
        </li>

        <!-- power arm -->
        <!-- TODO: add power hand? -->

        <li Class="OrenoMSE.XpathPatches.PatchOperationAddOrMerge">
          <xpath>/Defs/HediffDef[@ParentName="addedPartBionics"][defName="PowerArm"]</xpath>
          <value>
            <comps>
              <li Class="OrenoMSE.Modules.HediffCompProperties_ModuleHolder">
                <maxModules>1</maxModules>
              </li>
            </comps>
          </value>
        </li>

        <li Class="OrenoMSE.XpathPatches.PatchOperationAddOrMerge">
          <xpath>/Defs/ThingDef[@ParentName="Bionic"][defName="PowerArm"]</xpath>
          <value>
            <comps>
              <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                <standardChildren>
                  <li>BionicHand</li>
                  <li>PlasteelHumerus</li>
                  <li>PlasteelRadius</li>
                </standardChildren>
              </li>
            </comps>
          </value>
        </li>

        <li Class="PatchOperationReplace">
          <xpath>/Defs/RecipeDef[defName="InstallPowerArm"]/appliedOnFixedBodyParts</xpath>
          <value>
            <appliedOnFixedBodyParts>
              <li>Arm</li>
            </appliedOnFixedBodyParts>
          </value>
        </li>

        <!-- bionic arm -->

        <li Class="OrenoMSE.XpathPatches.PatchOperationAddOrMerge">
          <xpath>/Defs/ThingDef[@ParentName="Bionic"][defName="BionicArm"]</xpath>
          <value>
            <comps>
              <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                <standardChildren>
                  <li>BionicHand</li>
                  <li>BionicInternalSupport</li>
                  <li>BionicInternalSupport</li>
                </standardChildren>
              </li>
            </comps>
          </value>
        </li>

        <li Class="PatchOperationReplace">
          <xpath>/Defs/RecipeDef[defName="InstallBionicArm"]/appliedOnFixedBodyParts</xpath>
          <value>
            <appliedOnFixedBodyParts>
              <li>Arm</li>
            </appliedOnFixedBodyParts>
          </value>
        </li>

        <!-- bionic leg -->

        <li Class="OrenoMSE.XpathPatches.PatchOperationAddOrMerge">
          <xpath>/Defs/ThingDef[@ParentName="Bionic"][defName="BionicLeg"]</xpath>
          <value>
            <comps>
              <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                <standardChildren>
                  <li>BionicFoot</li>
                  <li>BionicInternalSupport</li>
                  <li>BionicInternalSupport</li>
                </standardChildren>
              </li>
            </comps>
          </value>
        </li>

        <!-- bionic hand -->

        <li Class="OrenoMSE.XpathPatches.PatchOperationAddOrMerge">
          <xpath>/Defs/ThingDef[@ParentName="Bionic"][defName="BionicHand"]</xpath>
          <value>
            <comps>
              <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                <standardChildren>
                  <li>BionicFinger</li>
                  <li>BionicFinger</li>
                  <li>BionicFinger</li>
                  <li>BionicFinger</li>
                  <li>BionicFinger</li>
                </standardChildren>
              </li>
            </comps>
          </value>
        </li>

        <!-- bionic foot -->

        <li Class="OrenoMSE.XpathPatches.PatchOperationAddOrMerge">
          <xpath>/Defs/ThingDef[@ParentName="Bionic"][defName="BionicFoot"]</xpath>
          <value>
            <comps>
              <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                <standardChildren>
                  <li>BionicToe</li>
                  <li>BionicToe</li>
                  <li>BionicToe</li>
                  <li>BionicToe</li>
                  <li>BionicToe</li>
                </standardChildren>
              </li>
            </comps>
          </value>
        </li>


        <!-- adding new parts -->

        <li Class="PatchOperationAdd">
          <xpath>/Defs</xpath>
          <value>

            <!-- internal support -->

            <HediffDef ParentName="addedPartBionics">
              <defName>BionicInternalSupport</defName>
              <label>bionic internal support</label>
              <labelNoun>a bionic internal support</labelNoun>
              <description>An installed bionic internal support.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicInternalSupport</ThingDef>
              </descriptionHyperlinks>
              <spawnThingOnRemoved>BionicInternalSupport</spawnThingOnRemoved>
              <addedPartProps>
                <solid>true</solid>
                <betterThanNatural>true</betterThanNatural>
                <partEfficiency>1.10</partEfficiency>
              </addedPartProps>
            </HediffDef>

            <ThingDef ParentName="Bionic">
              <defName>BionicInternalSupport</defName>
              <label>bionic internal support</label>
              <description>An advanced artificial internal support. Useful replacement to have on hand for when a bionic arm or leg breaks.</description>
              <descriptionHyperlinks>
                <RecipeDef>InstallBionicInternalSupport</RecipeDef>
              </descriptionHyperlinks>
              <costList>
                <Plasteel>6</Plasteel>
              </costList>
              <thingSetMakerTags>
                <li>RewardStandardMidFreq</li>
              </thingSetMakerTags>
              <statBases>
                <Mass>0.3</Mass>
              </statBases>
            </ThingDef>

            <RecipeDef ParentName="SurgeryBionic">
              <defName>InstallBionicInternalSupport</defName>
              <label>install bionic internal support</label>
              <description>Install a bionic internal support.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicInternalSupport</ThingDef>
              </descriptionHyperlinks>
              <jobString>Installing bionic internal support.</jobString>
              <ingredients>
                <li>
                  <filter>
                    <thingDefs>
                      <li>BionicInternalSupport</li>
                    </thingDefs>
                  </filter>
                  <count>1</count>
                </li>
              </ingredients>
              <fixedIngredientFilter>
                <thingDefs>
                  <li>BionicInternalSupport</li>
                </thingDefs>
              </fixedIngredientFilter>
              <appliedOnFixedBodyParts>
                <li>Humerus</li>
                <li>Radius</li>
                <li>Femur</li>
                <li>Tibia</li>
              </appliedOnFixedBodyParts>
              <addsHediff>BionicInternalSupport</addsHediff>
              <modExtensions>
                <li Class="OrenoMSE.PartInstallation.InstallationRestrictions">
                  <whitelist>
                    <li>BionicArm</li>
                    <li>BionicLeg</li>
                  </whitelist>
                </li>
              </modExtensions>
            </RecipeDef>

            <!-- bionic finger -->

            <HediffDef ParentName="addedPartBionics">
              <defName>BionicFinger</defName>
              <label>bionic finger</label>
              <labelNoun>a bionic finger</labelNoun>
              <description>An installed bionic finger.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicFinger</ThingDef>
              </descriptionHyperlinks>
              <addedPartProps>
                <partEfficiency>1.25</partEfficiency>
              </addedPartProps>
              <spawnThingOnRemoved>BionicFinger</spawnThingOnRemoved>
            </HediffDef>

            <ThingDef ParentName="Bionic">
              <defName>BionicFinger</defName>
              <label>bionic finger</label>
              <description>An advanced artificial finger. With its biogel nerve-link and lattice-dust healing system, it is better than a biological finger in almost every way.</description>
              <descriptionHyperlinks>
                <RecipeDef>InstallBionicFinger</RecipeDef>
              </descriptionHyperlinks>
              <costList>
                <Plasteel>2</Plasteel>
                <ComponentIndustrial>1</ComponentIndustrial>
              </costList>
              <statBases>
                <Mass>0.1</Mass>
              </statBases>
            </ThingDef>

            <RecipeDef ParentName="SurgeryBionic">
              <defName>InstallBionicFinger</defName>
              <label>install bionic finger</label>
              <description>Install a bionic finger.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicFinger</ThingDef>
              </descriptionHyperlinks>
              <jobString>Installing bionic finger.</jobString>
              <ingredients>
                <li>
                  <filter>
                    <thingDefs>
                      <li>BionicFinger</li>
                    </thingDefs>
                  </filter>
                  <count>1</count>
                </li>
              </ingredients>
              <fixedIngredientFilter>
                <thingDefs>
                  <li>BionicFinger</li>
                </thingDefs>
              </fixedIngredientFilter>
              <appliedOnFixedBodyParts>
                <li>Finger</li>
              </appliedOnFixedBodyParts>
              <addsHediff>BionicFinger</addsHediff>
            </RecipeDef>

            <!-- toes -->

            <HediffDef ParentName="addedPartBionics">
              <defName>BionicToe</defName>
              <label>bionic toe</label>
              <labelNoun>a bionic toe</labelNoun>
              <description>An installed bionic toe.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicToe</ThingDef>
              </descriptionHyperlinks>
              <spawnThingOnRemoved>BionicToe</spawnThingOnRemoved>
              <addedPartProps>
                <partEfficiency>1.25</partEfficiency>
              </addedPartProps>
            </HediffDef>

            <ThingDef ParentName="Bionic">
              <defName>BionicToe</defName>
              <label>bionic toe</label>
              <description>An advanced artificial toe. With its biogel nerve-link and lattice-dust healing system, it is better than a biological toe in almost every way.</description>
              <descriptionHyperlinks>
                <RecipeDef>InstallBionicToe</RecipeDef>
              </descriptionHyperlinks>
              <costList>
                <Plasteel>2</Plasteel>
                <ComponentIndustrial>1</ComponentIndustrial>
              </costList>
              <thingSetMakerTags>
                <li>RewardStandardMidFreq</li>
              </thingSetMakerTags>
              <statBases>
                <Mass>0.05</Mass>
              </statBases>
            </ThingDef>

            <RecipeDef ParentName="SurgeryBionic">
              <defName>InstallBionicToe</defName>
              <label>install bionic toe</label>
              <description>Install a bionic toe.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicToe</ThingDef>
              </descriptionHyperlinks>
              <jobString>Installing bionic toe.</jobString>
              <ingredients>
                <li>
                  <filter>
                    <thingDefs>
                      <li>BionicToe</li>
                    </thingDefs>
                  </filter>
                  <count>1</count>
                </li>
              </ingredients>
              <fixedIngredientFilter>
                <thingDefs>
                  <li>BionicToe</li>
                </thingDefs>
              </fixedIngredientFilter>
              <appliedOnFixedBodyParts>
                <li>Toe</li>
              </appliedOnFixedBodyParts>
              <addsHediff>BionicToe</addsHediff>
            </RecipeDef>

            <!-- bionic shoulder -->

            <HediffDef ParentName="addedPartBionics">
              <defName>BionicShoulder</defName>
              <label>bionic shoulder</label>
              <labelNoun>a bionic shoulder</labelNoun>
              <description>An installed bionic arm.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicShoulder</ThingDef>
              </descriptionHyperlinks>
              <addedPartProps>
                <partEfficiency>1.25</partEfficiency>
              </addedPartProps>
              <spawnThingOnRemoved>BionicShoulder</spawnThingOnRemoved>
            </HediffDef>

            <ThingDef ParentName="Bionic">
              <defName>BionicShoulder</defName>
              <label>bionic shoulder</label>
              <description>One of the most sophisticated shoulder replacements.</description>
              <descriptionHyperlinks>
                <RecipeDef>InstallBionicShoulder</RecipeDef>
              </descriptionHyperlinks>
              <costList>
                <SimpleProstheticShoulder>1</SimpleProstheticShoulder>
                <Plasteel>45</Plasteel>
                <ComponentIndustrial>5</ComponentIndustrial>
              </costList>
              <statBases>
                <Mass>7</Mass>
              </statBases>
              <comps>
                <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                  <standardChildren>
                    <li>BionicArm</li>
                    <li>PlasteelClavicle</li>
                  </standardChildren>
                </li>
              </comps>
            </ThingDef>

            <RecipeDef ParentName="SurgeryBionic">
              <defName>InstallBionicShoulder</defName>
              <label>install bionic shoulder</label>
              <description>Installs a bionic shoulder.</description>
              <descriptionHyperlinks>
                <ThingDef>BionicShoulder</ThingDef>
              </descriptionHyperlinks>
              <jobString>Installing bionic shoulder.</jobString>
              <ingredients>
                <li>
                  <filter>
                    <thingDefs>
                      <li>BionicShoulder</li>
                    </thingDefs>
                  </filter>
                  <count>1</count>
                </li>
              </ingredients>
              <fixedIngredientFilter>
                <thingDefs>
                  <li>BionicShoulder</li>
                </thingDefs>
              </fixedIngredientFilter>
              <appliedOnFixedBodyParts>
                <li>Shoulder</li>
              </appliedOnFixedBodyParts>
              <addsHediff>BionicShoulder</addsHediff>
            </RecipeDef>

            <!-- power claw -->

            <RecipeDef ParentName="MSE_SurgeryInstallModuleBase">
              <defName>InstallPowerClaw</defName>
              <label>install power claw module</label>
              <description>Install a power claw.</description>
              <descriptionHyperlinks>
                <ThingDef>PowerClaw</ThingDef>
              </descriptionHyperlinks>
              <jobString>Installing power claw.</jobString>
              <ingredients>
                <li>
                  <filter>
                    <thingDefs>
                      <li>PowerClaw</li>
                    </thingDefs>
                  </filter>
                  <count>1</count>
                </li>
              </ingredients>
              <fixedIngredientFilter>
                <thingDefs>
                  <li>PowerClaw</li>
                </thingDefs>
              </fixedIngredientFilter>
              <appliedOnFixedBodyParts>
                <li>Hand</li>
              </appliedOnFixedBodyParts>
              <addsHediff>PowerClaw</addsHediff>
            </RecipeDef>

          </value>
        </li>

      </operations>
    </match>
  </Operation>

</Patch>