<?xml version="1.0" encoding="utf-8" ?>
<Patch>

	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Royalty</li>
		</mods>
		<match Class="PatchOperationSequence">
			<operations>

                <!-- Drill Arm -->

				<li Class="OrenoMSE.XpathPatches.PatchOperationAddToList">
					<xpath>/Defs/ThingDef[defName="DrillArm"]</xpath>
					<list>comps</list>
					<value>
						<li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
							<standardChildren>
								<li>MechanicalManipulator</li>
                                <!-- TODO: add special bone like mechanical internal supports -->
								<li>SimpleProstheticHumerus</li>
								<li>SimpleProstheticRadius</li>
							</standardChildren>
						</li>
					</value>
				</li>

                <!-- Field Hand -->

				<li Class="OrenoMSE.XpathPatches.PatchOperationAddToList">
					<xpath>/Defs/ThingDef[defName="FieldHand"]</xpath>
					<list>comps</list>
					<value>
						<li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
							<standardChildren>
								<li>FieldFinger</li>
								<li>FieldFinger</li>
								<li>FieldFinger</li>
								<li>FieldFinger</li>
								<li>FieldFinger</li>
							</standardChildren>
						</li>
					</value>
				</li>
                
                <li Class="PatchOperationReplace">
					<xpath>/Defs/HediffDef[defName="FieldHand"]/stages/li/statOffsets/PlantWorkSpeed</xpath>
					<value>
						<PlantWorkSpeed>0.10</PlantWorkSpeed>
					</value>
				</li>

                <li Class="PatchOperationAdd">
					<xpath>/Defs</xpath>
					<value>
                    
                        <!-- Mechanical Manipulator -->

						<HediffDef ParentName="AddedBodyPartBase">
                            <defName>MechanicalManipulator</defName>
                            <label>mechanical manipulator</label>
                            <labelNoun>a mechanical manipulator</labelNoun>
                            <description>An installed mechanical manipulator.</description>
                            <descriptionHyperlinks><ThingDef>MechanicalManipulator</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
			                    <partEfficiency>0.90</partEfficiency>
                            </addedPartProps>
                            <spawnThingOnRemoved>MechanicalManipulator</spawnThingOnRemoved>
                        </HediffDef>

						<ThingDef ParentName="BodyPartProstheticImperialBase">
                            <defName>MechanicalManipulator</defName>
                            <label>mechanical manipulator</label>
                            <description>A general-purpose manipulator, not as good as normal hand but better than nothing.</description>
                            <descriptionHyperlinks><RecipeDef>InstallMechanicalManipulator</RecipeDef></descriptionHyperlinks>
                            <costList>
                                <Steel>30</Steel>
                                <ComponentIndustrial>6</ComponentIndustrial>
                            </costList>
                            <recipeMaker>
                                <researchPrerequisite>SpecializedLimbs</researchPrerequisite>
                            </recipeMaker>
                            <comps>
                                <li Class="OrenoMSE.CompProperties_CompIncludedChildParts">
                                    <standardChildren>
                                        <li>MechanicalFinger</li>
                                        <li>MechanicalFinger</li>
                                        <li>MechanicalFinger</li>
                                        <li>MechanicalFinger</li>
                                        <li>MechanicalFinger</li>
                                    </standardChildren>
                                </li>
                            </comps>
                        </ThingDef>

                        <RecipeDef ParentName="SurgeryInstallBodyPartProstheticBase">
                            <defName>InstallMechanicalManipulator</defName>
                            <label>install mechanical manipulator</label>
                            <description>Install a mechanical manipulator.</description>
                            <descriptionHyperlinks><ThingDef>MechanicalManipulator</ThingDef></descriptionHyperlinks>
                            <jobString>Installing mechanical manipulator.</jobString>
                            <ingredients>
                                <li>
                                    <filter>
                                    <thingDefs>
                                        <li>MechanicalManipulator</li>
                                    </thingDefs>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>MechanicalManipulator</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyParts>
                                <li>Hand</li>   
                            </appliedOnFixedBodyParts>
                            <addsHediff>MechanicalManipulator</addsHediff>
                        </RecipeDef>

                        <!-- Mechanical Finger -->

						<HediffDef ParentName="AddedBodyPartBase">
                            <defName>MechanicalFinger</defName>
                            <label>mechanical finger</label>
                            <labelNoun>a mechanical finger</labelNoun>
                            <description>An installed mechanical finger.</description>
                            <descriptionHyperlinks><ThingDef>MechanicalFinger</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
			                    <partEfficiency>0.90</partEfficiency>
                            </addedPartProps>
                            <spawnThingOnRemoved>MechanicalFinger</spawnThingOnRemoved>
                        </HediffDef>

						<ThingDef ParentName="BodyPartProstheticImperialBase">
                            <defName>MechanicalFinger</defName>
                            <label>mechanical finger</label>
                            <description>A general purpose mechanical finger.</description>
                            <descriptionHyperlinks><RecipeDef>InstallMechanicalFinger</RecipeDef></descriptionHyperlinks>
                            <costList>
                                <Steel>4</Steel>
                                <ComponentIndustrial>1</ComponentIndustrial>
                            </costList>
                            <recipeMaker>
                                <researchPrerequisite>SpecializedLimbs</researchPrerequisite>
                            </recipeMaker>
                        </ThingDef>

                        <RecipeDef ParentName="SurgeryInstallBodyPartProstheticBase">
                            <defName>InstallMechanicalFinger</defName>
                            <label>install mechanical finger</label>
                            <description>Install a mechanical finger.</description>
                            <descriptionHyperlinks><ThingDef>MechanicalFinger</ThingDef></descriptionHyperlinks>
                            <jobString>Installing mechanical finger.</jobString>
                            <ingredients>
                                <li>
                                    <filter>
                                    <thingDefs>
                                        <li>MechanicalFinger</li>
                                    </thingDefs>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>MechanicalFinger</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyParts>
                                <li>Finger</li>   
                            </appliedOnFixedBodyParts>
                            <addsHediff>MechanicalFinger</addsHediff>
                        </RecipeDef>
                
                        <!-- Field Fingers -->

						<HediffDef ParentName="AddedBodyPartBase">
                            <defName>FieldFinger</defName>
                            <label>field finger</label>
                            <labelNoun>a field finger</labelNoun>
                            <description>An installed field finger.</description>
                            <descriptionHyperlinks><ThingDef>FieldFinger</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
                            </addedPartProps>
                            <stages>
                            <li>
                                <statOffsets>
                                    <PlantWorkSpeed>0.30</PlantWorkSpeed>
                                </statOffsets>
                            </li>
                            </stages>
                            <spawnThingOnRemoved>FieldFinger</spawnThingOnRemoved>
                        </HediffDef>

						<ThingDef ParentName="BodyPartProstheticImperialBase">
                            <defName>FieldFinger</defName>
                            <label>field finger</label>
                            <description>This mechanical finger replacement is made to speed up the sowing and harvesting tasks of a farmer, it can harvest from several points on the same plant, or precisely sow several holes at once.</description>
                            <descriptionHyperlinks><RecipeDef>InstallFieldFinger</RecipeDef></descriptionHyperlinks>
                            <costList>
                                <Steel>8</Steel>
                                <ComponentIndustrial>1</ComponentIndustrial>
                            </costList>
                            <recipeMaker>
                                <researchPrerequisite>SpecializedLimbs</researchPrerequisite>
                            </recipeMaker>
                        </ThingDef>
                        
                        <RecipeDef ParentName="SurgeryInstallBodyPartProstheticBase">
                            <defName>InstallFieldFinger</defName>
                            <label>install field finger</label>
                            <description>Install a field finger.</description>
                            <descriptionHyperlinks><ThingDef>FieldFinger</ThingDef></descriptionHyperlinks>
                            <jobString>Installing field finger.</jobString>
                            <ingredients>
                                <li>
                                    <filter>
                                    <thingDefs>
                                        <li>FieldFinger</li>
                                    </thingDefs>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>FieldFinger</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyParts>
                                <li>Finger</li>   
                            </appliedOnFixedBodyParts>
                            <addsHediff>FieldFinger</addsHediff>
                        </RecipeDef>

                        <!-- Make implants usable as modules -->

                        <!-- Hand Talon -->

                        <HediffDef ParentName="MSE_ModuleAddedBionic">
                            <defName>HandTalonModule</defName>
                            <label>hand talon module</label>
                            <labelNoun>a hand talon module</labelNoun>
                            <description>An installed hand talon module.</description>
                            <descriptionHyperlinks><ThingDef>HandTalon</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
                            </addedPartProps>
                            <comps>
                                <li Class="HediffCompProperties_VerbGiver">
                                    <tools>
                                    <li>
                                        <label>scratch</label>
                                        <capacities>
                                        <li>Scratch</li>
                                        </capacities>
                                        <power>15</power>
                                        <cooldownTime>2</cooldownTime>
                                        <alwaysTreatAsWeapon>true</alwaysTreatAsWeapon>
                                    </li>
                                    </tools>
                                </li>
                            </comps>
                            <spawnThingOnRemoved>HandTalon</spawnThingOnRemoved>
                        </HediffDef>

                        <RecipeDef ParentName="MSE_SurgeryModuleBionic">
                            <defName>InstallHandTalonModule</defName>
                            <label>install hand talon module</label>
                            <description>Install a hand talon module.</description>
                            <descriptionHyperlinks><ThingDef>HandTalon</ThingDef></descriptionHyperlinks>
                            <jobString>Installing hand talon module.</jobString>
                            <ingredients>
                            <li>
                                <filter>
                                <thingDefs>
                                    <li>HandTalon</li>
                                </thingDefs>
                                </filter>
                                <count>1</count>
                            </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>HandTalon</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyParts>
                                <li>Hand</li>
                            </appliedOnFixedBodyParts>
                            <addsHediff>HandTalonModule</addsHediff>
                        </RecipeDef>

                        <!-- Elbow blade -->

                        <HediffDef ParentName="MSE_ModuleAddedBionic">
                            <defName>ElbowBladeModule</defName>
                            <label>elbow blade module</label>
                            <labelNoun>an elbow blade module</labelNoun>
                            <description>An installed elbow blade module.</description>
                            <descriptionHyperlinks><ThingDef>ElbowBlade</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
                            </addedPartProps>
                            <comps>
                                <li Class="HediffCompProperties_VerbGiver">
                                    <tools>
                                    <li>
                                        <label>slice</label>
                                        <capacities>
                                            <li>Cut</li>
                                        </capacities>
                                        <power>15</power>
                                        <cooldownTime>2</cooldownTime>
                                        <alwaysTreatAsWeapon>true</alwaysTreatAsWeapon>
                                    </li>
                                    </tools>
                                </li>
                            </comps>
                            <spawnThingOnRemoved>ElbowBlade</spawnThingOnRemoved>
                        </HediffDef>

                        <RecipeDef ParentName="MSE_SurgeryModuleBionic">
                            <defName>InstallElbowBladeModule</defName>
                            <label>install elbow blade module</label>
                            <description>Install an elbow blade module.</description>
                            <descriptionHyperlinks><ThingDef>ElbowBlade</ThingDef></descriptionHyperlinks>
                            <jobString>Installing elbow blade module.</jobString>
                            <ingredients>
                            <li>
                                <filter>
                                <thingDefs>
                                    <li>ElbowBlade</li>
                                </thingDefs>
                                </filter>
                                <count>1</count>
                            </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>ElbowBlade</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyParts>
                                <li>Arm</li>
                            </appliedOnFixedBodyParts>
                            <addsHediff>ElbowBladeModule</addsHediff>
                        </RecipeDef>

                        <!-- Knee spike -->

                        <HediffDef ParentName="MSE_ModuleAddedBionic">
                            <defName>KneeSpikeModule</defName>
                            <label>knee spike module</label>
                            <labelNoun>a knee spike module</labelNoun>
                            <description>An installed knee spike module.</description>
                            <descriptionHyperlinks><ThingDef>KneeSpike</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
                            </addedPartProps>
                            <comps>
                                <li Class="HediffCompProperties_VerbGiver">
                                    <tools>
                                    <li>
                                        <label>stab</label>
                                        <capacities>
                                            <li>Stab</li>
                                        </capacities>
                                        <power>15</power>
                                        <cooldownTime>2</cooldownTime>
                                        <alwaysTreatAsWeapon>true</alwaysTreatAsWeapon>
                                    </li>
                                    </tools>
                                </li>
                            </comps>
                            <spawnThingOnRemoved>KneeSpike</spawnThingOnRemoved>
                        </HediffDef>

                        <RecipeDef ParentName="MSE_SurgeryModuleBionic">
                            <defName>InstallKneeSpikeModule</defName>
                            <label>install knee spike module</label>
                            <description>Install a knee spike module.</description>
                            <descriptionHyperlinks><ThingDef>KneeSpike</ThingDef></descriptionHyperlinks>
                            <jobString>Installing knee spike module.</jobString>
                            <ingredients>
                            <li>
                                <filter>
                                <thingDefs>
                                    <li>KneeSpike</li>
                                </thingDefs>
                                </filter>
                                <count>1</count>
                            </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>KneeSpike</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyParts>
                                <li>Leg</li>
                            </appliedOnFixedBodyParts>
                            <addsHediff>KneeSpikeModule</addsHediff>
                        </RecipeDef>

                        <!-- Venom talon -->

                        <HediffDef ParentName="MSE_ModuleAddedBionic">
                            <defName>VenomTalonModule</defName>
                            <label>venom talon module</label>
                            <labelNoun>a venom talon module</labelNoun>
                            <description>An installed venom talon module.</description>
                            <descriptionHyperlinks><ThingDef>VenomTalon</ThingDef></descriptionHyperlinks>
                            <addedPartProps>
                                <solid>true</solid>
                            </addedPartProps>
                            <comps>
                                <li Class="HediffCompProperties_VerbGiver">
                                    <tools>
                                    <li>
                                        <label>venom talon</label>
                                        <capacities>
                                            <li>ScratchToxic</li>
                                        </capacities>
                                        <power>8.2</power>
                                        <cooldownTime>2</cooldownTime>
                                        <alwaysTreatAsWeapon>true</alwaysTreatAsWeapon>
                                    </li>
                                    </tools>
                                </li>
                            </comps>
                            <spawnThingOnRemoved>VenomTalon</spawnThingOnRemoved>
                        </HediffDef>

                        <RecipeDef ParentName="MSE_SurgeryModuleBionic">
                            <defName>InstallVenomTalonModule</defName>
                            <label>install venom talon module</label>
                            <description>Install a venom talon module.</description>
                            <descriptionHyperlinks><ThingDef>VenomTalon</ThingDef></descriptionHyperlinks>
                            <jobString>Installing venom talon module.</jobString>
                            <ingredients>
                            <li>
                                <filter>
                                <thingDefs>
                                    <li>VenomTalon</li>
                                </thingDefs>
                                </filter>
                                <count>1</count>
                            </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <thingDefs>
                                    <li>VenomTalon</li>
                                </thingDefs>
                            </fixedIngredientFilter>
                            <appliedOnFixedBodyPartGroups>
                                <li>MiddleFingers</li>
                            </appliedOnFixedBodyPartGroups>
                            <addsHediff>VenomTalonModule</addsHediff>
                        </RecipeDef>
                        

					</value>
				</li>

                <!-- Add module recipe hyperlinks to thingdefs -->

				<li Class="OrenoMSE.XpathPatches.PatchOperationAddToList">
					<xpath>/Defs/ThingDef[defName="HandTalon"]</xpath>
					<list>descriptionHyperlinks</list>
					<value>
						<RecipeDef>InstallHandTalonModule</RecipeDef>
					</value>
				</li>
				<li Class="OrenoMSE.XpathPatches.PatchOperationAddToList">
					<xpath>/Defs/ThingDef[defName="ElbowBlade"]</xpath>
					<list>descriptionHyperlinks</list>
					<value>
						<RecipeDef>InstallElbowBladeModule</RecipeDef>
					</value>
				</li>
				<li Class="OrenoMSE.XpathPatches.PatchOperationAddToList">
					<xpath>/Defs/ThingDef[defName="KneeSpike"]</xpath>
					<list>descriptionHyperlinks</list>
					<value>
						<RecipeDef>InstallKneeSpikeModule</RecipeDef>
					</value>
				</li>
				<li Class="OrenoMSE.XpathPatches.PatchOperationAddToList">
					<xpath>/Defs/ThingDef[defName="VenomTalon"]</xpath>
					<list>descriptionHyperlinks</list>
					<value>
						<RecipeDef>InstallVenomTalonModule</RecipeDef>
					</value>
				</li>

                
			</operations>
		</match>
	</Operation>

</Patch>